# CV Condensed Analysis 
This program generates condensed plots to compare various CV data: Peak Value, Doping Width FWHM, Gain Depletion Voltage, Peak Depth, Total Depletion Voltage. This program can make two kinds of comparisions:
1. **Wafer by Wafer comparison**: WNo on the xaxis, CV data on the yaxis, and marker type indicating type of SEn detector 
2. **Type by Type comparison**: Type on the xaxis, CV data on the yaxis, and marker type indicating type of SEn detector

The program also generates condensed plots which average the different SEn values and plots the average with error bars that indicate the RMS. 

*Required Local Modules*: Functions.py 


### Functions Library (Functions.py)
**Required python libraries**: numpy, pandas, matplotlib.pyplot, csv, scipy (stats, optimize.fsolve, interpolate.UnivariateSpline), seaborn, openpyxl

Most of these libraries should come built-in with python 
To install openpyxl: 
```bash
$ pip install openpyxl
```
To install seaborn
```bash
$ pip install seaborn
```
To install scipy 
```bash
$ pip install scipy
```

This is the functions library that contains all the functions used by IV.py, IVmultiple.py, CV.py, and CVmultiple.py. The functions are listed in alphabetical order and descriptions of the function and all the input parameters, optional input paramaters, return parameters are provided in the module. 

Example 1: This is a function found in Functions.py to determine the breakdown voltage 

```python 
def bvol(df, x, y, thresh = 0.9995):
    """
    Parameters:
        df: Pandas dataframe 
        x: String - name of x column in df (voltage)
        y: String - name of y column in df (capacitance)
    Optional Parameters: 
        thresh: Float - r squared threshold value
    Returns:
        bvol: Float - Breakdown Voltage 
    Note: 
        This function determines the breakdown by calculation the point where the relationship between the first and second derivative becomes extremely linear. 
    """
    frst_der = manual_der(df[x], df[y])
    scnd_der = manual_der(df[x], frst_der)
    
    r_value = 1
    N = 2
    while round(r_value,4) >= thresh: #Threshold for linearity
        X = np.log(frst_der[-N:])
        Y = np.log(scnd_der[-N:])
        slope, intercept, r_value, p_value, std_err = stats.linregress(X,Y)
        N = N+1
          
    voltage = df[x].as_matrix()
    bvol = voltage[-N+1]
    return bvol
```

As seen by the comments in the function, this function takes a dataframe, and two strings (x and y column names) as inputs and returns the breakdown voltage as a float. It has an optional parameter that can be left to its default value of 0.9995 or changed by passing an input. For example, if we want to change the threshold voltage to 0.8, the function can be called in the following way:
```python 
bvol(df, "Sweep Voltage", "pad", thresh = 0.8 )
```

## Input 

### Data file 

The input datafile (excel file or csv file or something similar) should have the following columns respectively. 
```text 
Wafer, Detector, Gain Depletion Voltage (V), Total Depletion Voltage (V), Peak Depth (um), Peak Value (cm^-3), Doping Width FWHM  (um)
```
If CVmultiple.py is used, these column names need to be manually inputted before running CVmultiple.py . Once manually inputted, CVmultiply.py automatically inputs the data in the respective columns of the file. 

*Note the program will still work if different number of columns and names of columns are used as long as the column names are manually inputted in the excel file. 

The path of the input datafile can be parsed using optional parsing (-- file).
For example, the path "\Testdata\CVdata.csv" can be parsed using the following command:
```bash 
python CVcondensed.py --file \Testdata\CVdata.csv
```
You can also input the path of the file by changing the default parameter in line 25. 

### Image Path 
The path to store the plots generated by program can be specified by changing the definition of the variable *impath*. Note that all the points where modification are required by the user are indicated by the command: *MODIFY FOR USER*. So far, optional parsing capabilites have not been implemented for this parameter. 


### Plotting categorical data 
The function plotbycat is used to plot different sets of categorical data. The function has the following parameters:
1. **xaxis**: String - Name of x axis column in dataframe df 
2. **yaxis**: String - Name of y axis column in dataframe df 
3. **marker_cat** : String - Name of marker column in dataframe df (category of data that the different markers represent ex. SEn)
4. **markers**: List: List of names for each marker  
5. **df**: Pandas Dataframe
6. **impath**: String - path where image will be saved

**Example:**
For *Plotting Doping Width vs Type and separating SEn by markers* : 
```python
1. xaxis: "Type"
2. yaxis: "Doping Width"
3. marker_cat: "Detector"
4. markers = ['SE2', 'SE3', 'SE5']
5. df = df 
6. impath: "CV/test.png"
```
***

For further questions email sneha.ramshanker@pmb.ox.ac.uk










